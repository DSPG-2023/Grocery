<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DSPGGrocery">
<title>Estimating Market Size • DSPGGrocery</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Market Size">
<meta property="og:description" content="DSPGGrocery">
<meta property="og:image" content="https://dspg-2023.github.io/Grocery/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DSPGGrocery</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Est-Expenses.html">Estimating Expenses</a>
    <a class="dropdown-item" href="../articles/Est-Market-Size.html">Estimating Market Size</a>
    <a class="dropdown-item" href="../articles/Est-Total-Revenue.html">Estimating Total Revenue</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimating Market Size</h1>
            
      
      
      <div class="d-none name"><code>Est-Market-Size.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="dspggrocery-current-operations">DSPGGrocery Current Operations<a class="anchor" aria-label="anchor" href="#dspggrocery-current-operations"></a>
</h2>
<p>Estimating market size has three main components. Metro population,
population, and rural population. Metro population is the number of
people who live in the town the proposed grocery store will be in.
Determining this is as simple as parsing the name of the town and using
tidycensus to get the population. Next is the populations of the towns
around where we are building the store. This is more complicated, we are
using a buffer around the city to figure out the names of these towns,
and then from there we can use a loop and tidycensus. Rural population
is the people who don’t live in a city. We can figure this out very
roughly by figuring out all the people who live in the county, and then
subtracting all the people that live in all the cities in that county.
We then multiply this by the percentage of the area of the county
covered by our market area. This is constricted by counties, and gives a
very rough estimate.</p>
<p>For our calculations we are estimating the area covered by our trade
area by finding the distance to the nearest store in each quadrant (NE,
NW, SE, SW). We use that distance as the radius of a quarter circle to
figure out how much reach our store has. This is a very bad way of
determining the market region as the only thing it takes into account is
distance to the closest store, and also ignores the radius that the
other store would have. A more elegant solution to this would be Voronoi
polygons or Reilly’s law of Retail Gravitation.</p>
</div>
<div class="section level2">
<h2 id="alternates">Alternates<a class="anchor" aria-label="anchor" href="#alternates"></a>
</h2>
<div class="section level3">
<h3 id="voronoi">Voronoi<a class="anchor" aria-label="anchor" href="#voronoi"></a>
</h3>
<p>A Voronoi Polygon is a polygon defined where all points in a region
would be closer to a parent node than any other nodes. This would show
us a more accurate estimate of the market area because it would take the
other store into account because people who live nearer to that store
than our store would most likely choose to shop at that one instead.</p>
<p><img src="https://i.stack.imgur.com/bJs12.png"></p>
</div>
<div class="section level3">
<h3 id="reillys-law">Reilly’s Law<a class="anchor" aria-label="anchor" href="#reillys-law"></a>
</h3>
<p>Reilly’s law is an economic principle that states that people are
more drawn to areas with a higher population than those with smaller
populations. This is an excellent way to estimate market area, but is
somewhat complicated. Maps are usually edited by hand to account for
geographic barriers such as rivers, and there are various limitations
such as the populations of the two cities having to be relatively
similar.</p>
</div>
<div class="section level3">
<h3 id="huffs-law">Huff’s Law<a class="anchor" aria-label="anchor" href="#huffs-law"></a>
</h3>
<p>Huff’s law is a probabilistic model for estimating consumer
attraction. It states that the attractiveness of a store and the
something called distance decay determine the likelihood of someone
visiting the store. Distance decay is the idea that as people move
farther and farther away, the likelihood exponentially decreases that
they would visit the store. In the real world this would mean that even
though a store might be 10 times more attractive than another, if it is
10 times farther away, they most likely will not travel to it.</p>
</div>
</div>
<div class="section level2">
<h2 id="code">Code<a class="anchor" aria-label="anchor" href="#code"></a>
</h2>
<div class="section level3">
<h3 id="shaping-the-data">Shaping the data<a class="anchor" aria-label="anchor" href="#shaping-the-data"></a>
</h3>
<p>We needed several helper methods to shape the data to the way we want
it. Address Parser is a simple function to take an address as a string
and turn it into a list.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Address_Parser</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">address</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">split_addr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">address</span>, <span class="st">", "</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">split_addr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"street"</span>, <span class="st">"city"</span>, <span class="st">"state"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">split_addr</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We also made a function that takes in an address, parses it, and then
converts it into a dataframe with columns for cities in the county and
their populations. This is used a lot throughout other functions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Pop_Binder</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">address</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co">#Doing this because I want to use this variable in Metro_Pop</span></span>
<span>  <span class="va">splt_addr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Address_Parser.html">Address_Parser</a></span><span class="op">(</span><span class="va">address</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">geocoded_address</span> <span class="op">&lt;-</span> <span class="fu">geocode</span><span class="op">(</span>location <span class="op">=</span> <span class="va">address</span>, output <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span>  <span class="va">geo_county</span> <span class="op">&lt;-</span> <span class="va">geocoded_address</span><span class="op">[[</span><span class="st">"results"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"address_components"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"long_name"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">geo_county</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span> <span class="st">" County"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">geo_county</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">city_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>state <span class="op">=</span> <span class="va">splt_addr</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, county <span class="op">=</span> <span class="va">geo_county</span>, city <span class="op">=</span> <span class="va">splt_addr</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co">#city_df &lt;- data.frame(state = "Iowa", county = "Sac")</span></span>
<span>  <span class="va">city_in_county</span> <span class="op">&lt;-</span> <span class="fu">get_cities_in_county</span><span class="op">(</span><span class="va">city_df</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">county_cities_list</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">city_in_county</span><span class="op">$</span><span class="va">city_list</span>, <span class="st">", "</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#This gives us the name of city and the population. We need to separate city</span></span>
<span>  <span class="co">#and state name, and then remove the city and CDP from the NAME so we can join</span></span>
<span>  <span class="co">#with the county_cities_list</span></span>
<span></span>
<span>  <span class="va">place_pop</span> <span class="op">&lt;-</span> <span class="fu">get_decennial</span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>                             geography <span class="op">=</span> <span class="st">"place"</span>,</span>
<span>                             variables <span class="op">=</span> <span class="st">"DP1_0001C"</span>,</span>
<span>                             sumfile <span class="op">=</span> <span class="st">"dp"</span>,</span>
<span>                             state <span class="op">=</span> <span class="va">city_in_county</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">place_pop</span><span class="op">$</span><span class="va">NAME</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span> <span class="st">" city"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">place_pop</span><span class="op">$</span><span class="va">NAME</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">place_pop</span><span class="op">$</span><span class="va">NAME</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span> <span class="st">" CDP"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">place_pop</span><span class="op">$</span><span class="va">NAME</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">place_pop</span> <span class="op">&lt;-</span> <span class="fu">separate</span><span class="op">(</span>data <span class="op">=</span> <span class="va">place_pop</span>, col <span class="op">=</span> <span class="va">NAME</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"City"</span>, <span class="st">"State"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>  <span class="co">#Convert County cities list to a data frame in the correct shape and name</span></span>
<span>  <span class="co">#to join with place_pop</span></span>
<span>  <span class="va">county_cities_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">county_cities_list</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>City <span class="op">=</span> <span class="st">"unlist.county_cities_list."</span><span class="op">)</span></span>
<span>  <span class="va">county_cities_df</span> <span class="op">&lt;-</span> <span class="fu">rename</span><span class="op">(</span><span class="va">county_cities_df</span>, <span class="fu">all_of</span><span class="op">(</span><span class="va">lookup</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">bound_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">county_cities_df</span>, <span class="va">place_pop</span>, by<span class="op">=</span><span class="st">'City'</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">bound_df</span>, County <span class="op">=</span> <span class="va">geo_county</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Our program is able to pull from the Google Places API to find the
nearby stores, but it only gives us the latitude and longitude of each
of the stores, not a distance, and not a direction. This function takes
the data frame from the API call and figures out which direction each of
the stores is, and returns the nearest store in each quadrant. Because
the original data frame gives us lat longs, which is a measure of
position and not distance, we have to first convert it into another
coordinate system called UTM, or Universal Transverse Mercator
coordinates. These are a measure of distance, we can easily compare the
points to find a distance between them, and since they are based on how
far East and North the point is, we can determine which direction from
the origin point the new point is.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Distance_Comparator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_places_grocery</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co">#Creates a new dataframe with the Lat, Long, and Name columns</span></span>
<span>  <span class="co">#This step is completely unnecessary, but the original DF</span></span>
<span>  <span class="co">#had awful column names and I didn't want to have to look at all</span></span>
<span>  <span class="co">#the other columns</span></span>
<span>  <span class="va">api_stores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> Name <span class="op">=</span> <span class="va">df_places_grocery</span><span class="op">$</span><span class="va">name</span>,</span>
<span>                            lat <span class="op">=</span> <span class="va">df_places_grocery</span><span class="op">$</span><span class="va">lat</span>,</span>
<span>                            lng <span class="op">=</span> <span class="va">df_places_grocery</span><span class="op">$</span><span class="va">lng</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#Add Northing and Easting Columns</span></span>
<span>  <span class="va">UTM_geo</span> <span class="op">&lt;-</span> <span class="fu">lonlat2utm</span><span class="op">(</span>longitude <span class="op">=</span> <span class="va">df_geocode</span><span class="op">$</span><span class="va">lng</span>,</span>
<span>                             latitude <span class="op">=</span> <span class="va">df_geocode</span><span class="op">$</span><span class="va">lat</span>,</span>
<span>                             zone <span class="op">=</span> <span class="fu">UTM_Zoner</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">api_stores</span><span class="op">$</span><span class="va">lng</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df_geocode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df_geocode</span>, <span class="va">UTM_geo</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">UTM_df</span> <span class="op">&lt;-</span> <span class="fu">lonlat2utm</span><span class="op">(</span>longitude <span class="op">=</span> <span class="va">api_stores</span><span class="op">$</span><span class="va">lng</span>,</span>
<span>                            latitude <span class="op">=</span> <span class="va">api_stores</span><span class="op">$</span><span class="va">lat</span>,</span>
<span>                            zone <span class="op">=</span> <span class="fu">UTM_Zoner</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">api_stores</span><span class="op">$</span><span class="va">lng</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">api_stores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">api_stores</span>, <span class="va">UTM_df</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Save variables for testing.</span></span>
<span>  <span class="co">#this is not a test I need this</span></span>
<span>  <span class="va">origin_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">df_geocode</span><span class="op">$</span><span class="va">easting</span>, <span class="va">df_geocode</span><span class="op">$</span><span class="va">northing</span><span class="op">)</span></span>
<span>  <span class="va">end_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">api_stores</span><span class="op">$</span><span class="va">easting</span>, <span class="va">api_stores</span><span class="op">$</span><span class="va">northing</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co">#### FUNCTION TEST - Call Function</span></span>
<span>  <span class="co">#this is not a test function, this is integral to the program functionality</span></span>
<span>  <span class="co">#this saves a global variable named df_new with the distance appended</span></span>
<span>  <span class="fu"><a href="../reference/Distance_Euclidean.html">Distance_Euclidean</a></span><span class="op">(</span><span class="va">api_stores</span>, origin <span class="op">=</span> <span class="va">origin_test</span>, end <span class="op">=</span> <span class="va">end_test</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span>  <span class="co"># Create Dataframes with stores in each quadrant</span></span>
<span></span>
<span>  <span class="co">#Creates a new dataframe with all of the stores in each quadrant</span></span>
<span>  <span class="va">northeast_stores</span> <span class="op">&lt;-</span> <span class="va">df_new</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_new</span><span class="op">$</span><span class="va">northing</span><span class="op">)</span></span>
<span>                                        <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_geocode</span><span class="op">$</span><span class="va">northing</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>                                        <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_new</span><span class="op">$</span><span class="va">easting</span><span class="op">)</span></span>
<span>                                        <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_geocode</span><span class="op">$</span><span class="va">easting</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">northwest_stores</span> <span class="op">&lt;-</span> <span class="va">df_new</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_new</span><span class="op">$</span><span class="va">northing</span><span class="op">)</span></span>
<span>                                        <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_geocode</span><span class="op">$</span><span class="va">northing</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>                                        <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_new</span><span class="op">$</span><span class="va">easting</span><span class="op">)</span></span>
<span>                                        <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_geocode</span><span class="op">$</span><span class="va">easting</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">southeast_stores</span> <span class="op">&lt;-</span> <span class="va">df_new</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_new</span><span class="op">$</span><span class="va">northing</span><span class="op">)</span></span>
<span>                                        <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_geocode</span><span class="op">$</span><span class="va">northing</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>                                        <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_new</span><span class="op">$</span><span class="va">easting</span><span class="op">)</span></span>
<span>                                        <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_geocode</span><span class="op">$</span><span class="va">easting</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">southwest_stores</span> <span class="op">&lt;-</span> <span class="va">df_new</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_new</span><span class="op">$</span><span class="va">northing</span><span class="op">)</span></span>
<span>                                        <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_geocode</span><span class="op">$</span><span class="va">northing</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>                                        <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_new</span><span class="op">$</span><span class="va">easting</span><span class="op">)</span></span>
<span>                                        <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_geocode</span><span class="op">$</span><span class="va">easting</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co"># Find distance to nearest in each quadrant</span></span>
<span></span>
<span>  <span class="co">#I guess in a conversion somewhere the value is being squared. Square rooting</span></span>
<span>  <span class="co">#Makes this correct.</span></span>
<span>  <span class="co">#Using %/%1 to remove decimal point</span></span>
<span>  <span class="va">northeast_dist</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">northeast_stores</span><span class="op">$</span><span class="va">distance_vector</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span><span class="fl">1</span></span>
<span>  <span class="va">northwest_dist</span> <span class="op">&lt;&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">northwest_stores</span><span class="op">$</span><span class="va">distance_vector</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span><span class="fl">1</span></span>
<span>  <span class="va">southeast_dist</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">southeast_stores</span><span class="op">$</span><span class="va">distance_vector</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span><span class="fl">1</span></span>
<span>  <span class="va">southwest_dist</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">southwest_stores</span><span class="op">$</span><span class="va">distance_vector</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span><span class="fl">1</span></span>
<span></span>
<span></span>
<span>  <span class="co">#df_new but with only closest stores named df_circle_buffer</span></span>
<span>  <span class="va">NE_min</span> <span class="op">&lt;-</span> <span class="va">northeast_stores</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">northeast_stores</span><span class="op">$</span><span class="va">distance_vector</span></span>
<span>                                        <span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">northeast_stores</span><span class="op">$</span><span class="va">distance_vector</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">NW_min</span> <span class="op">&lt;-</span> <span class="va">northwest_stores</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">northwest_stores</span><span class="op">$</span><span class="va">distance_vector</span></span>
<span>                                        <span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">northwest_stores</span><span class="op">$</span><span class="va">distance_vector</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">SE_min</span> <span class="op">&lt;-</span> <span class="va">southeast_stores</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">southeast_stores</span><span class="op">$</span><span class="va">distance_vector</span></span>
<span>                                        <span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">southeast_stores</span><span class="op">$</span><span class="va">distance_vector</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">SW_min</span> <span class="op">&lt;-</span> <span class="va">southwest_stores</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">southwest_stores</span><span class="op">$</span><span class="va">distance_vector</span></span>
<span>                                        <span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">southwest_stores</span><span class="op">$</span><span class="va">distance_vector</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df_circle_buffer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">NE_min</span>,<span class="va">NW_min</span>,<span class="va">SE_min</span>,<span class="va">SW_min</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">#add NESW labels</span></span>
<span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/Utm-zones-USA.svg/2560px-Utm-zones-USA.svg.png"></p>
</div>
<div class="section level3">
<h3 id="metro-population">Metro population<a class="anchor" aria-label="anchor" href="#metro-population"></a>
</h3>
<p>Metro population is a super simple function. It takes in an address
as a parameter, parses an address, and then filters to just cities with
that name.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Metro_Pop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">address</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">#We should be saving address as a global variable so we don't have to pass it</span></span>
<span>  <span class="co">#as a parameter in most of my functions</span></span>
<span>  <span class="va">splt_addr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Address_Parser.html">Address_Parser</a></span><span class="op">(</span><span class="va">address</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">City</span> <span class="op">==</span> <span class="va">splt_addr</span><span class="op">[</span><span class="st">"city"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>#TODO add Cities Pop and Rural Pop</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DSPGGrocery</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'DSPGGrocery'</span></span>
<span><span class="co">#&gt; The following object is masked _by_ '.GlobalEnv':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Address_Parser</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
