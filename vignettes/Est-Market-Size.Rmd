---
title: "Estimating Market Size"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Estimating Market Size}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  markdown: 
    wrap: 72
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# DSPGGrocery Current Operations

Estimating market size has three main components. Metro population,
population, and rural population. Metro population is the number of
people who live in the town the proposed grocery store will be in.
Determining this is as simple as parsing the name of the town and using
tidycensus to get the population. Next is the populations of the towns
around where we are building the store. This is more complicated, we are
using a buffer around the city to figure out the names of these towns,
and then from there we can use a loop and tidycensus. Rural population
is the people who don't live in a city. We can figure this out very
roughly by figuring out all the people who live in the county, and then
subtracting all the people that live in all the cities in that county.
We then multiply this by the percentage of the area of the county
covered by our market area. This is constricted by counties, and gives a
very rough estimate.

For our calculations we are estimating the area covered by our trade
area by finding the distance to the nearest store in each quadrant (NE,
NW, SE, SW). We use that distance as the radius of a quarter circle to
figure out how much reach our store has. This is a very bad way of
determining the market region as the only thing it takes into account is
distance to the closest store, and also ignores the radius that the
other store would have. A more elegant solution to this would be Voronoi
polygons or Reilly's law of Retail Gravitation.

# Code

## Shaping the data

We needed several helper methods to shape the data to the way we want
it. Address_Parser is a function to take an address as a string and turn
it into a list.

Pop_Binder is a function that takes in an address, parses it, and then
converts it into a data frame with columns for cities in the county and
their populations. This is used throughout several other functions.

Our program is able to pull from the Google Places API to find the
nearby stores, but it only gives us the latitude and longitude of each
of the stores, not a distance, and not a direction. This function takes
the data frame from the API call and figures out which direction each of
the stores is in, and returns the nearest store in each quadrant. We are
converting to UTM in order to filter our data frame into cardinal
quadrants to find the nearest store in each direction. In order to find
distance to each store, we are using something called the Haversine
equation. This is a method used to find distance between two GPS
coordinates while factoring in the curvature of the Earth.

![](images/Law-of-haversines.png)

## Populations

Metro_Pop is a function that determines the population of the city that
the potential store would be in.

Cities_Pop is a function that finds all the nearby cities and finds the
total of their populations. \
Auto_Rural is a function that finds the population of all people who
live in the market area but do not live in a town.

# Alternates

## Voronoi

A Voronoi Polygon is a polygon defined where all points in a region
would be closer to a parent node than any other nodes. This would show
us a more accurate estimate of the market area because it would take the
other store into account because people who live nearer to that store
than our store would most likely choose to shop at that one instead.

![](https://i.stack.imgur.com/bJs12.png)

## Reilly's Law

Reilly's law is an economic principle that states that people are more
drawn to areas with a higher population than those with smaller
populations. This is an excellent way to estimate market area, but is
somewhat complicated. Maps are usually edited by hand to account for
geographic barriers such as rivers, and there are various limitations
such as the populations of the two cities having to be relatively
similar.

## Huff's Law

Huff's law is a probabilistic model for estimating consumer attraction.
It states that the attractiveness of a store and the something called
distance decay determine the likelihood of someone visiting the store.
Distance decay is the idea that as people move farther and farther away,
the likelihood exponentially decreases that they would visit the store.
In the real world this would mean that even though a store might be 10
times more attractive than another, if it is 10 times farther away, they
most likely will not travel to it.
